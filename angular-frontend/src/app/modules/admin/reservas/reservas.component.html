<app-navbar-admin></app-navbar-admin>

<div class="p-6 max-w-7xl mx-auto">
  <h2 class="text-2xl font-bold mb-4 text-gray-800">Gestión de Reservas</h2>

  <ng-container *ngIf="!mostrarFormulario; else formulario">

    <button
      class="mb-4 bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600"
      (click)="crearReserva()"
    >
      Crear nueva reserva
    </button>

    <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow">
      <thead class="bg-indigo-600 text-white">
        <tr>
          <th class="px-4 py-2 text-left">Nombre</th>
          <th class="px-4 py-2 text-left">Email</th>
          <th class="px-4 py-2 text-left">Teléfono</th>
          <th class="px-4 py-2 text-left">Fecha Visita</th>
          <th class="px-4 py-2 text-left">Adultos</th>
          <th class="px-4 py-2 text-left">Niños</th>
          <th class="px-4 py-2 text-left">Precio Total</th>
          <th class="px-4 py-2 text-left">Estado</th>
          <th class="px-4 py-2 text-left">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let reserva of reservas" class="border-t border-gray-200">
          <td class="px-4 py-2">{{ reserva.nombre }} {{ reserva.apellidos }}</td>
          <td class="px-4 py-2">{{ reserva.email }}</td>
          <td class="px-4 py-2">{{ reserva.telefono }}</td>
          <td class="px-4 py-2">{{ reserva.fechaVisita }}</td>
          <td class="px-4 py-2">{{ contarEntradas(reserva, 'adulto') }}</td>
          <td class="px-4 py-2">{{ contarEntradas(reserva, 'niño') }}</td>
          <td class="px-4 py-2">{{ calcularPrecioTotal(reserva) | currency:'EUR' }}</td>
          <td class="px-4 py-2">{{ reserva.estado }}</td>
          <td class="px-4 py-2 space-x-2">
            <button class="text-blue-600 hover:underline" (click)="editarReserva(reserva)">Editar</button>
            <button class="text-red-600 hover:underline" (click)="eliminarReserva(reserva.id!)">Eliminar</button>
            <button class="text-yellow-600 hover:underline" *ngIf="reserva.estado !== 'cancelado'" (click)="cancelarReserva(reserva)">Cancelar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-container>

  <ng-template #formulario>
    <app-reserva-form
      [reserva]="reservaEnEdicion"
      (formSubmit)="guardarReserva($event)"
    ></app-reserva-form>

    <button class="mt-4 text-gray-500 hover:underline" (click)="cancelarFormulario()">
      Cancelar
    </button>
  </ng-template>
</div>
