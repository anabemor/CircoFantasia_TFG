<app-navbar-admin></app-navbar-admin>

<div class="p-6 max-w-7xl mx-auto">
  <h2 class="text-2xl font-bold mb-4 text-gray-800">Gestión de Reservas</h2>

  <!-- Botones de acción -->
  <div class="flex justify-between items-center mb-4">
    <button
      *ngIf="!mostrarFormularioCreacion && !mostrarFormularioEdicion"
      class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600"
      (click)="abrirFormularioCrear()"
    >
      Crear nueva reserva
    </button>

    <button mat-raised-button color="accent" (click)="toggleAforo()">
      {{ mostrarAforo ? 'Ocultar aforo' : 'Ver aforo' }}
    </button>
  </div>

  <!-- Tabla de aforo -->
  <app-aforo *ngIf="mostrarAforo" class="mb-6"></app-aforo>

  <!-- Tabla de reservas -->
  <ng-container *ngIf="!mostrarFormularioCreacion && !mostrarFormularioEdicion; else formularioActivo">
    <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow">
      <thead class="bg-indigo-600 text-white">
        <tr>
          <th class="px-4 py-2">Nombre</th>
          <th class="px-4 py-2">Email</th>
          <th class="px-4 py-2">Teléfono</th>
          <th class="px-4 py-2">Fecha Visita</th>
          <th class="px-4 py-2">Fecha Reserva</th>
          <th class="px-4 py-2">Adultos</th>
          <th class="px-4 py-2">Niños</th>
          <th class="px-4 py-2">Total</th>
          <th class="px-4 py-2">Estado</th>
          <th class="px-4 py-2">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let reserva of reservas" class="border-t border-gray-200">
          <td class="px-4 py-2">{{ reserva.nombre }} {{ reserva.apellidos }}</td>
          <td class="px-4 py-2">{{ reserva.email }}</td>
          <td class="px-4 py-2">{{ reserva.telefono }}</td>
          <td class="px-4 py-2">{{ reserva.fechaVisita }}</td>
          <td class="px-4 py-2">{{ reserva.fechaReserva }}</td>
          <td class="px-4 py-2">{{ contarEntradas(reserva, 'adulto') }}</td>
          <td class="px-4 py-2">{{ contarEntradas(reserva, 'niño') }}</td>
          <td class="px-4 py-2">{{ calcularPrecioTotal(reserva) | currency:'EUR' }}</td>
          <td class="px-4 py-2">
            <span [ngClass]="{
              'text-yellow-600 font-semibold': reserva.estado === 'pendiente',
              'text-green-600 font-semibold': reserva.estado === 'pagado',
              'text-red-600 font-semibold': reserva.estado === 'cancelado'
            }">
              {{ getEstadoVisual(reserva.estado) }}
            </span>
          </td>
          <td class="px-4 py-2 space-x-2">
            <button class="text-blue-600 hover:underline" (click)="editarReserva(reserva)">Editar</button>
            <button class="text-red-600 hover:underline" (click)="eliminarReserva(reserva.id!)">Eliminar</button>
            <button class="text-yellow-600 hover:underline" *ngIf="reserva.estado !== 'cancelado'" (click)="cancelarReserva(reserva)">Cancelar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-container>

  <!-- Formularios -->
  <ng-template #formularioActivo>
    <app-reserva-create-form
      *ngIf="mostrarFormularioCreacion"
      [aforoError]="aforoError" 
      (formSubmit)="crearReserva($event)"
    ></app-reserva-create-form>

    <app-reserva-form
      *ngIf="mostrarFormularioEdicion"
      [reserva]="reservaEnEdicion"
      (formSubmit)="guardarReserva($event)"
    ></app-reserva-form>
  </ng-template>
</div>
