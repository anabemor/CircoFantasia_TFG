<app-navbar-admin></app-navbar-admin>

<div class="p-6 max-w-7xl mx-auto bg-white rounded shadow space-y-6">
  <h2 class="text-3xl font-bold text-center text-gray-800">Historial de Reservas</h2>

  <!-- Filtros y acciones -->
  <form (ngSubmit)="filtrarReservas()" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 items-end">
    <!-- Fecha desde -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Desde</mat-label>
      <input matInput [matDatepicker]="picker1" [(ngModel)]="fechaInicio" name="fechaInicio" />
      <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
      <mat-datepicker #picker1></mat-datepicker>
    </mat-form-field>

    <!-- Fecha hasta -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Hasta</mat-label>
      <input matInput [matDatepicker]="picker2" [(ngModel)]="fechaFin" name="fechaFin" />
      <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
      <mat-datepicker #picker2></mat-datepicker>
    </mat-form-field>

    <!-- Botones de acción -->
    <div class="col-span-full flex flex-wrap gap-2 justify-end">
      <button
        type="submit"
        class="flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm"
      >
        <i class="material-icons text-sm">filter_alt</i> Filtrar
      </button>
      <button
        type="button"
        (click)="exportarPDF()"
        class="flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm"
      >
        <i class="material-icons text-sm">picture_as_pdf</i> PDF
      </button>
      <button
        type="button"
        (click)="exportarExcel()"
        class="flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm"
      >
        <i class="material-icons text-sm">table_view</i> Excel
      </button>
      <button
        type="button"
        [routerLink]="['/admin/reservas']"
        class="flex items-center gap-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm"
      >
        <i class="material-icons text-sm">arrow_back</i> Volver
      </button>
    </div>
  </form>

  <!-- Tabla de historial -->
  <div class="overflow-auto">
    <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow">
      <thead class="bg-indigo-600 text-white text-sm">
          <tr>
            <th class="px-4 py-2 text-left cursor-pointer select-none" (click)="ordenarPor('nombre')">
              Nombre
              <span *ngIf="ordenCampo === 'nombre'">{{ ordenAscendente ? '⬆' : '⬇' }}</span>
            </th>
            <th class="px-4 py-2 text-left cursor-pointer select-none" (click)="ordenarPor('email')">
              Email
              <span *ngIf="ordenCampo === 'email'">{{ ordenAscendente ? '⬆' : '⬇' }}</span>
            </th>
            <th class="px-4 py-2 text-left cursor-pointer select-none" (click)="ordenarPor('fechaVisita')">
              Fecha Visita
              <span *ngIf="ordenCampo === 'fechaVisita'">{{ ordenAscendente ? '⬆' : '⬇' }}</span>
            </th>
            <th class="px-4 py-2 text-center">Adultos</th>
            <th class="px-4 py-2 text-center">Niños</th>
            <th class="px-4 py-2 text-center">Total</th>
          </tr>
        </thead>
      <tbody>
        <tr
          *ngFor="let r of reservas"
          class="border-t border-gray-200 hover:bg-gray-50 text-sm"
        >
          <td class="px-4 py-2">{{ r.nombre }} {{ r.apellidos }}</td>
          <td class="px-4 py-2">{{ r.email }}</td>
          <td class="px-4 py-2">{{ r.fechaVisita | date:'dd/MM/yyyy' }}</td>
          <td class="px-4 py-2 text-center">{{ getCantidadPorTipo(r, 'Adulto') }}</td>
          <td class="px-4 py-2 text-center">{{ getCantidadPorTipo(r, 'Niño') }}</td>
          <td class="px-4 py-2 text-center">{{ getTotalReserva(r) | currency:'EUR' }}</td>
        </tr>

        <!-- Fila de totales -->
        <tr class="font-bold bg-gray-100 border-t text-sm">
          <td colspan="3" class="px-4 py-2 text-right">Totales:</td>
          <td class="px-4 py-2 text-center">{{ getTotalAdultos() }}</td>
          <td class="px-4 py-2 text-center">{{ getTotalNinos() }}</td>
          <td class="px-4 py-2 text-center">{{ getTotalPrecio() | currency:'EUR' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
