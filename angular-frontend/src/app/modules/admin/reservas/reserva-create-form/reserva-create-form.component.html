<form [formGroup]="form" (ngSubmit)="submit()" class="space-y-4">

  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Nombre</mat-label>
    <input matInput formControlName="nombre" />
    <mat-error *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched">Campo obligatorio</mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Apellidos</mat-label>
    <input matInput formControlName="apellidos" />
    <mat-error *ngIf="form.get('apellidos')?.invalid && form.get('apellidos')?.touched">Campo obligatorio</mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Fecha de nacimiento</mat-label>
    <input matInput [matDatepicker]="picker1" formControlName="fechaNacimiento" />
    <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
    <mat-datepicker #picker1></mat-datepicker>
    <mat-error *ngIf="form.get('fechaNacimiento')?.invalid && form.get('fechaNacimiento')?.touched">Campo obligatorio</mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Email</mat-label>
    <input matInput type="email" formControlName="email" />
    <mat-error *ngIf="form.get('email')?.invalid && form.get('email')?.touched">Email inválido</mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Teléfono</mat-label>
    <input matInput type="tel" formControlName="telefono" />
    <mat-error *ngIf="form.get('telefono')?.invalid && form.get('telefono')?.touched">Debe tener 9 dígitos</mat-error>
  </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
    <mat-label>Fecha de visita</mat-label>
    <input
      matInput
      [matDatepicker]="picker2"
      [min]="fechaMinima"
      [matDatepickerFilter]="filtroFechaDisponible"
      formControlName="fechaVisita"
    />
    <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
    <mat-datepicker #picker2 [dateClass]="marcarFechasCompletas"></mat-datepicker>
    <mat-error *ngIf="form.get('fechaVisita')?.invalid && form.get('fechaVisita')?.touched">
      Campo obligatorio
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Estado</mat-label>
    <mat-select formControlName="estado">
      <mat-option value="pendiente">Pendiente</mat-option>
      <mat-option value="pagado">Pagado</mat-option>
    </mat-select>
  </mat-form-field>

  <!-- Entradas -->
  <div formArrayName="tickets">
    <label class="block font-medium mb-2">Entradas</label>
    <div *ngFor="let control of tickets.controls; let i = index" [formGroupName]="i" class="flex items-center gap-4 mb-2">
      <div class="flex-1">
        {{ control.get('ticketType')?.value?.nombre }} -
        {{ control.get('ticketType')?.value?.precio | currency:'EUR' }}
      </div>
      <mat-form-field appearance="fill">
        <mat-label>Cantidad</mat-label>
        <input matInput type="number" formControlName="cantidad" min="0" />
      </mat-form-field>
    </div>
  </div>

  <!-- Total -->
  <div class="text-right font-bold text-lg mt-4">
    Total: {{ getPrecioTotal() | currency:'EUR' }}
  </div>
  
  <!--  Aforo completo -->
  <div *ngIf="aforoError" class="text-red-600 text-sm mt-2 text-right">
    {{ aforoError }}
  </div>

  <!-- Botones -->
  <div class="flex justify-end gap-4 mt-6">
    <button mat-stroked-button color="warn" type="button" (click)="volver()">Cancelar</button>
    <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid">Crear reserva</button>
  </div>
