<app-navbar-admin></app-navbar-admin>

<div class="p-6 max-w-6xl mx-auto">
  <h2 class="text-3xl font-bold mb-6 text-gray-800">Gestión de Actividades</h2>

  <!-- Botón Crear actividad -->
  <div class="mb-6 flex justify-start">
    <button class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg shadow" (click)="crearNueva()">
      Crear nueva actividad
    </button>
  </div>

  <!-- Formulario -->
  <div *ngIf="mostrarFormulario" class="mb-10 bg-white/80 backdrop-blur-md border border-gray-200 p-6 rounded-2xl shadow-xl">
    <h3 class="text-2xl font-semibold mb-4 text-gray-800">{{ modoEdicion ? 'Editar' : 'Nueva' }} Actividad</h3>

    <form (ngSubmit)="guardarActividad()" #actividadForm="ngForm" novalidate class="space-y-5">
      <!-- Nombre -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
        <input
          type="text"
          class="w-full px-4 py-2 rounded-lg bg-white text-black placeholder-purple-400 border border-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          [(ngModel)]="formActividad.nombre"
          name="nombre"
          required
          #nombre="ngModel"
        />
        <div *ngIf="nombre.invalid && nombre.touched" class="text-red-600 text-sm mt-1">Este campo es obligatorio.</div>
      </div>

      <!-- Descripción -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
        <textarea
          class="w-full px-4 py-2 rounded-lg bg-white text-black placeholder-purple-400 border border-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          [(ngModel)]="formActividad.descripcion"
          name="descripcion"
          required
          #descripcion="ngModel"
        ></textarea>
        <div *ngIf="descripcion.invalid && descripcion.touched" class="text-red-600 text-sm mt-1">Este campo es obligatorio.</div>
      </div>

      <!-- Fecha de inicio -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de inicio</label>
        <input
          type="date"
          class="w-full px-4 py-2 rounded-lg bg-white text-black border border-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          [(ngModel)]="formActividad.fechaInicio"
          name="fechaInicio"
          required
          #fechaInicio="ngModel"
          (change)="validarFechas()"
        />
        <div *ngIf="fechaInicio.invalid && fechaInicio.touched" class="text-red-600 text-sm mt-1">Este campo es obligatorio.</div>
      </div>

      <!-- Fecha de fin -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de fin</label>
        <input
          type="date"
          class="w-full px-4 py-2 rounded-lg bg-white text-black border border-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          [(ngModel)]="formActividad.fechaFin"
          name="fechaFin"
          required
          #fechaFin="ngModel"
          (change)="validarFechas()"
        />
        <div *ngIf="fechaFin.invalid && fechaFin.touched" class="text-red-600 text-sm mt-1">Este campo es obligatorio.</div>
        <div *ngIf="fechasInvalidas" class="text-red-600 text-sm mt-1">La fecha de fin debe ser posterior a la de inicio.</div>
      </div>

      <!-- Activa -->
      <div>
        <label class="inline-flex items-center text-sm text-gray-700">
          <input type="checkbox" class="mr-2" [(ngModel)]="formActividad.activa" name="activa" />
          Activar actividad (las fechas activas no deben solaparse).
        </label>
      </div>

      <!-- Botones -->
      <div class="flex gap-3">
        <button
          type="submit"
          class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 disabled:opacity-50"
          [disabled]="actividadForm.invalid || fechasInvalidas"
        >
          Guardar
        </button>
        <button type="button" class="bg-gray-300 px-4 py-2 rounded-lg hover:bg-gray-400" (click)="cancelar()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Tabla -->
  <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow">
    <thead class="bg-indigo-600 text-white">
      <tr>
        <th class="px-4 py-2 text-left">Nombre</th>
        <th class="px-4 py-2 text-left">Descripción</th>
        <th class="px-4 py-2 text-left">Fecha</th>
        <th class="px-4 py-2 text-left">Activa</th>
        <th class="px-4 py-2 text-left">Vigente</th>
        <th class="px-4 py-2 text-left">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let actividad of actividades" class="border-t border-gray-200">
        <td class="px-4 py-2">{{ actividad.nombre }}</td>
        <td class="px-4 py-2">{{ actividad.descripcion }}</td>
        <td class="px-4 py-2">{{ actividad.fechaInicio }} → {{ actividad.fechaFin }}</td>
        <td class="px-4 py-2">{{ actividad.activa ? 'Sí' : 'No' }}</td>
        <td class="px-4 py-2">{{ actividad.vigente ? 'Sí' : 'No' }}</td>
        <td class="px-4 py-2">
          <div class="flex justify-end gap-2">
            <button
              (click)="editarActividad(actividad)"
              class="flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
              title="Editar"
            >
              <i class="material-icons text-base leading-none">edit</i>
              Editar
            </button>

            <button
              (click)="eliminarActividad(actividad.id!)"
              class="flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm"
              title="Eliminar"
            >
              <i class="material-icons text-base leading-none">delete</i>
              Eliminar
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

   <!-- Tipos de ticket -->
    <h3 class="text-2xl font-semibold mt-10 mb-4 text-gray-800">Precio de los Tickets</h3>
    <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow">
      <thead class="bg-purple-600 text-white">
        <tr>
          <th class="px-4 py-2 text-left">Nombre</th>
          <th class="px-4 py-2 text-left">Precio</th>
          <th class="px-4 py-2 text-left">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let tipo of ticketTypes" class="border-t border-gray-200">
          <td class="px-4 py-2">{{ tipo.nombre }}</td>
          <td class="px-4 py-2">
            <input type="number" class="w-24 p-1 border rounded" [(ngModel)]="tipo.precio" />
          </td>
          <td class="px-4 py-2">
            <button
              class="flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded"
              (click)="actualizarPrecio(tipo)"
              title="Guardar"
            >
              <i class="material-icons text-sm">save</i>
              Guardar
            </button>
          </td>
        </tr>
      </tbody>
    </table>


  <!-- Botón volver -->
  <div class="mt-6 flex justify-end">
    <button [routerLink]="['/admin']" class="flex items-center gap-1 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
      <i class="material-icons text-sm">arrow_back</i>
      Volver
    </button>
  </div>
</div>
